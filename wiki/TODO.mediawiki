---
title: TODO
---

= PA-RISC Linux TODO (actually this is Helge's TODO list) =

== Updates for next newsletter ==
* fixed 64bit SMP kernel & sticon on machines with more than 4GB RAM
* Dave found O_SYNC bug in glibc (Typo in hppa __O_SYNC define in <bits/fcntl.h>)
* syscall fixes with compat kernel
* Migration parisc-linux.org
* debian-ports.org access
* 3.13 with all patches in (coherency)
* buildds running
* wiki migration finished (05 Feb)

== Potential ABI breakage ==
* We dropped HP-UX-Support in kernel 3.14 by changing EWOULDBLOCK==EAGAIN, possibly change number of signals (for systemd), .. what else? (I believe we should pull the plug on HP-UX entirely.  If there ever was enough interest, It should be supported in a VM.  Machines are relatively cheap now.  So, if someone needs hpux, they can buy a machine for it.) We have a more diverse user space under Linux and I believe in supporting open source, so we should focus on it. https://patchwork.kernel.org/patch/3499551/
* More signals? > Can we change _NSIG to 69 so there are 32 RT signals as on other arches? It looks like it needs to be a power of 2.  MIPS uses 128. 

== Testsuites - to be checked ==
* We also have a problem with poll in rpcbind on 32-bit kernels. Runs forever. Not analyzed yet.
* glib2.0 atomic bug: Dave: I see the problem building various packages -- apt is is one. It occurs when multiple dot processes are started by graph when package documentation is being generated.  The number of dot processes spawned depends on the number of processors on the build system.  However, the faults occur even on a UP system. I debugged one of these segvs enough to see that the problem occurred in a glib2.0 library.  It's using the GCC "sync" interface. 
* From Dave: gcc thread issues including thread cancellation, glib2.0 problem, maybe __tls_get_addr clobber too?

== Status & TODO 2014-05-01 (TODO-List by Helge Deller) ==
* Enable BMC in c8000 default kernel config - ipmi driver (CONFIG_IPMI_HANDLER=y)
* Make it possible to disable logs of userspace crashes (do_page_fault() pid=1082...)
* eglibc mmap bug with localedef (see debian bugzilla http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=741243)
** DONE: change kernel SHMLBA=PAGE_SIZE -> http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=0ef36bd2b37815719e31a72d2beecc28ca8ecd26
** glibc patch to set SHMLBA=PAGE_SIZE -> https://patchwork.kernel.org/patch/3933841/
** debian-cd to use xorriso
** debian-cd: do not compress kernel.
* SLAB breaks, SLUB works, why? Mail from Guy Martin.
* why does mc hangs when exiting on sticon ?
* implement .con_font_set (consw) in sticon.c (to be able to change fonts at runtime)
* DONE: test xorriso (Thomas Schmitt, scdbackup)
* crash in GSP, is everything visible (GSP reset?) 
* DONE: remove HIL RTC from debian kernel - it creates a backtrace at boot because we have already another rtc0 active.
* Add loop module to debian kernel.
* 3.14 partly: gcc-4.8 switch on debian, perl-bug (mmap of small files). https://patchwork.kernel.org/patch/3279031/
* 3.14 partly: return ((unsigned long) mapping >> 7) & ((SHMLBA >> PAGE_SHIFT) - 1); in arch/parisc/kernel/sys_parisc.c
* 3.14 partly: debian parisc perl bug (http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721537) shows that mmap on parisc linux is horribly inefficient.  We allocate huge maps for small files. This should be improved. Mailthread: " parisc mmap: private file maps" ,http://www.spinics.net/lists/linux-parisc/msg05083.html  or  https://rt.perl.org/Public/Bug/Display.html?id=119567  https://rt.perl.org/Public/Bug/Display.html?id=119567 
* use CONFIG_COMPAT_BINFMT_ELF and get rid of arch/parisc/kernel/binfmt_elf32.c
* sparsemem: http://lwn.net/Articles/439472/ -> convert to sparsemem (http://lwn.net/Articles/440056/), patch available from James
* gdb crashes Kernel - http://permalink.gmane.org/gmane.linux.ports.parisc/5406

* add wiki page about kernel cross-compiling

* currently planned features for 3.13 / 3.14:
** better implementation to get stack pointer (in return_address(), in stack checker in irq.c, ...)
** physically broken memory in Dave's machine - utilize PDT (http://ftp.parisc-linux.org/docs/arch/pdc20-v1.1-Ch4-pdc.pdf (page #46)) - https://patchwork.kernel.org/patch/2541561/

* Kernel: Hard to solve outstanding issues
** megaraid on my rp5470 hangs at boot (maybe because SCSI chassis not connected)? -> use new megaraid driver for debian
** Fix FireGL X1/X3 in C8000 - currently broken (no DRM and software accel is incredibly slow plus colors in 24bpp mode are wrong) - Info: manual "Radeon R5xx Acceleration" - http://www.x.org/docs/AMD/R5xx_Acceleration_v1.1.pdf  and generic: http://www.botchco.com/agd5f/?p=50 

* Kernel: still missing Linux kernel development (no patches available yet):
** add new LWS CAS: 1, 4 (already implemented), and 8 are useful today. Need 16 to keep up with the newer Intel hardware support compare and exchange on int128_t. So just add a 1, 8, and 16 to the list as future proof and ready for tomorrow.
** Fix FTRACE: https://patchwork.kernel.org/patch/3554391/
** optimize flush_dcache_page() implementation like sparc. See Documentation/cachetlb.txt, e.g. used in aio subsystem
** Implement CONFIG_DEBUG_STACK_USAGE ?
** fix wrong _init notation in kernel
** NO_IRQ -> should be converted to (0) instead of (-1) -> Helge (check assembly, check in drivers/parisc/*)
** implement alternative coding for UP/SMP. See arch/x86/include/asm/alternative.h
** check assembly in drivers/parisc/*
** use pdc_add_valid() in kern_addr_valid(),  protect against crashable acesses (like for superio-pc-drivers-detection in lp), add pdc_add_valid() to create a probe_kernel_read() implementation.
** arch/parisc/kernel/sys_parisc.c -> use SYSCALL_ALIAS() -> maybe
** on C8000, report 1 socket with 2 cores.
** implement HUGE pages (or even better transparent huge pages)
** Review gettimeofday and clock_gettime() implementation, possibly use a light-weight-syscall and rely on cr16 and cpu speed for more accurate timing? similiar to commit http://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=18ad51dd342a7eb09dbcd059d0b451b616d4dafc 

* Kernel: Low priority patches needs further work 
** Fix exception table entries to be of type int (32bit), even on 64bit kernel -> saves space. - https://patchwork.kernel.org/patch/3033801/ - partly done.
** disable FP-register save/restore at kernel entry? - Helge
** enable 16k/64k kernel page sizes (still cacheflushing-issues with SCSI driver, additional work in glibc needed to deal with >4k page size, e.g. ld-loader alignments of data/code segments)
** Superdome support - can someone test? Should work better now with latest kernels.
** task_struct/thread_info split -- task_struct should not be visible in entry.S, we need to move some items into thread_info -- this includes pt_regs and maybe some of the flags (ptrace, etc)
** Visualize FX support (will probably never happen!)

* Debian packaging work:
** STARTED: Build real debian-installer CD. See: https://wiki.debian.org/Simple-CDD/Howto
** DONE: we need a kernel debian package (3.10 based or higher)
** DONE: debian-ports/parisc repository aka. syning debs to there
*** DONE: Helge to contact Aurelien (aurel32) on #debian-glibc on OFTC IRC
*** DONE: try to debootstrap from parisc-linux.org repository and add missing packages.
** DONE: split repository on parisc-linux.org into stable (wheezy) and unstable (sid)
** DONE: send patches to remove UP from debian kernels, use sil680 instead of siimage, see http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721191 -> fixed in 3.12 / 3.13

* Debian packages / Userspace work
** qt4-x11: Improve atomic support on parisc (https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=741190)
** IMPORTANT: fix OpenJDK - fixes required in zeroport (stack grows up!).
** 64-bit userspace, 64-bit binutils needs to be fixed to get multiple stub section support.
** gcc -> join 32- and 64bit compiler, make "-m64" work, get rid of hppa64-linux-gnu-gcc
   
* Homepage migration:
** ONGOING: Migration of parisc-linux.org website to https://parisc.wiki.kernel.org
** DONE: Migration of wiki.parisc-linux.org website to https://parisc.wiki.kernel.org
** Domain ownwer: Matt Taggart <matt@lackof.org>, Expiration Date:09-Aug-2014 23:07:58 UTC
** DNS takeover by Thibaut Varenet on 11/11/2013 - see: http://article.gmane.org/gmane.linux.ports.parisc/5478
** New domain owner: Thibaut VARENE <T-Bone@parisc-linux.org> <T-Bone@slashdirt.org>
** Server administrator of parisc-linux.org: Dann Frazier - dannf@dannf.org
** Technical contact at HP: brett.johnson@hp.com

* palo (PA-RISC Boot Loader):
** Modify (if possible), that palo can read (sequential) tftpbootable-vmlinuxes as well as the current boot-vmlinux images (simplifies build/handling)
** move decompression to Linux kernel instead of palo

= DONE =
* Document news and howto on the parisc-linux website on how to upgrade/install parisc servers
** See [[Debian_Ports_Installation]] and [[https://parisc.wiki.kernel.org]]

== Kernel patches ==
* Kernel 3.9:
** Integrate Dave Anglin's latest cacheflush patchset (fixes unusual userspace crashes) https://patchwork.kernel.org/patch/2480891/ - Dave 
** add ucmpdi2() symbol to kernel - https://patchwork.kernel.org/patch/2468471/ - Dave
** patch to disable -mlong-calls compiler option when building kernel modules - https://patchwork.kernel.org/patch/2480001/
** James Bottomley's explanation of kernel gateway page - in 3.10
** lib/atomic64_test.c:131:2: warning: #warning Please implement atomic64_dec_if_positive for your architecture - in 3.10
** add interrupt statistics like x86 to /proc/interrupts - in 3.10
** kernel"-crashes in the area of do_softirq() - irq stacks implemented: https://patchwork.kernel.org/patch/2497501/
** test/build kernel with allmodconfig/allyesconfig
** error in lib/mpi/longlong.h,umul_ppmm() uses floating point -> https://patchwork.kernel.org/patch/2521621/
** update MAINTAINERS file, git tree -> https://patchwork.kernel.org/patch/2580161/
** lockdep issues with irqstack patch in UP configurations. Fixed -> https://patchwork.kernel.org/patch/2589321/
** add /proc/interrupt counters for floating point assist and unaligned handler traps -> https://patchwork.kernel.org/patch/2589161
** CONFIG_PREEMPT works now -> https://patchwork.kernel.org/patch/2624241/
** parisc: make default cross compiler search more robust (v3)
** parisc: fix SMP races when updating PTE and TLB entries in entry.S
** parisc: use long branch in fork_like macro
** parisc: only re-enable interrupts if we need to schedule or deliver signals when returning to userspace
* Kernel 3.10
** stifb broken (PCI broken?) -> https://patchwork.kernel.org/patch/2636821/ -> 3.10-rc4
** parport hangs / lp -> https://patchwork.kernel.org/patch/2638331/ -> 3.10-rc4
** MAINTAINERS update -> https://patchwork.kernel.org/patch/2636601/ -> 3.10-rc4
* Kernel 3.11:
** parport (lp) fix
** defaultconfig for C8000
** C8000 workstation support in 3.11 and 3.10.X stable (serial port irq, IOMMU range fixes, FireGL radeon AGP fix, vma memory fix)
** remove arch/parisc/kernel/sys32.h
** pa_memcpy() was broken on 64bit (due to gcc miscompiling nonstandard C-code)
* Kernel 3.12:
** Fix 64bit SMP kernel on HP Visualize J-6750, 32bit SMP does work (Machine owners: Dave Land, Domenico Andreoli) -> fixed in 3.12 and backported >= kernel 2.6.12 (http://git.kernel.org/cgit/linux/kernelgit/torvalds/linux.git/commit/?id=54e181e073fc1415e41917d725ebdbd7de956455)
** fix kernel crash when running "echo t > /proc/sysrq-trigger" http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=59b33f148cc08fb33cbe823fca1e34f7f023765e
** regenerate defconfigs to include CONFIG_DEVTMPFS=y and CONFIG_DEVTMPFS_MOUNT=y to avoid udev/initrd problems. Done. http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c1b14041aa86800cfd9e21b280b0eaee885fa623
** IMPI/BMC patch from Thomas Bogendoerfer - http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=fdbeb7de700a3c8fc85d7e595a6bf1c92a27c0a1 - test with: "ipmitool sdr"
* Kernel 3.13
** STIcon broken on 64bit with > 4GB RAM - https://patchwork.kernel.org/patch/3149621/
** New defaultconfigs for 32- and 64-bit - https://patchwork.kernel.org/patch/2825923/, enabled BMC IPMI & disabled HP SDC for 64bit
** implement audit functionality, https://patchwork.kernel.org/patch/3046731/
** avoid dependencies on bzimage during make install, https://patchwork.kernel.org/patch/3069691/
** exception table entries can be of type int (32bit), even on 64bit kernel -> saves space. - https://patchwork.kernel.org/patch/3033801/
* Kernel 3.14
** Native types in uapi/asm/stat.h
** Dropped HP-UX Support: changed EWOULDBLOCK = EAGAIN -> https://patchwork.kernel.org/patch/3499551/
** sticon font problem fixed, sticon now automatically chooses the Linux fb fonts if available instead of using the HP fonts
* Kernel 3.15
** epoll_pwait bug: debian packages libio-epoll-perl and python-falcon failed -> http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=ab3e55b119c9653b19ea4edffb86f04db867ac98
** pthread_create() out-of-memory bug, failed only when used with GNU make, e.g. zeromq3 package. Reason: stack hard limit problems -> http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=b5f3c61d06165c3dddddbc30772f079c2c8589ca

== Debian userspace programs ==
* Problem building libcap-ng...The problem is the call to __tls_get_addr clobbers the value loaded into %r26 for the printf call. -> http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59777 

* PALO (http://git.kernel.org/cgit/linux/kernel/git/deller/palo.git/)
** increase palo command line from 128 bytes (max from kernel is 1024 currently) -> fixed in palo 1.92. 
** accept /boot/ in front of files, strip path (e.g. "/boot") when given for kernel/ramdisk 
** Migrate to git.kernel.org -> done: http://git.kernel.org/cgit/linux/kernel/git/deller/palo.git/
** add gzip-support (allow loading gzipped vmlinux files)
** in interactive mode, add reboot option command



== Debian infrastructure work ==
* DONE: Ask Thibaut to add ftp mirror of http://ftp.parisc-linux.org/debian_ports on http://www.fr.parisc-linux.org/ 
* DONE: Set up a buildd server for debian-ports/unstable & experimental -> http://unstable.buildd.net/index-hppa.html
* DONE: contact pannonmage@gmail.com (Nemeth Balint, Budapest) to set up buildd server - mail from 04.08.2013
* DONE: set up buildd server on ESIEE's A500 (Thibaut) - mail from 13.08.2013 


= Kernel Testing Tools =

* https://github.com/linux-test-project/ltp - Linux Test Project
* http://codemonkey.org.uk/projects/trinity/ - Trinity - A Linux System call fuzz tester.

= TODO Drivers =

* IPMI support on rp-class / Support graceful shutdown from BMC on rp servers (`PC -GRACEFUL`)
* write Lasi floppy driver
* write Suckyio floppy driver
* write spifi driver (rbrad)
* modify ncr53c8xx driver for Outfield (735 & 755)
* write GSC FDDI driver
* write Timi ASIC (74x) support
* EISA DMA support

== Review all the todo entries below! ==

* ns87415 dma doesn't work reliably on suckyio-systems

* investigate not putting in extable entries for put_kernel_asm; will probably reduce kernel size

* fix HIL problem: ksoftirqd/0 eats 56% cpu (kernel 2.4 & kernel 2.6) - see FAQ: http://www.parisc-linux.org/faq/index.html and http://article.gmane.org/gmane.linux.ports.parisc/278/match=use+lower+nice+level+ksoftirqd+hil+enabled